<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>tourMap</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.0.3/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.0.3/dist/leaflet.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet-providers/1.1.15/leaflet-providers.min.js"></script>
    <script src="https://d3js.org/d3.v4.min.js"></script>

    <style>
      body {
        padding: 0;
        margin: 0;
      }
      html, body{
        height: 100%;
      }
      #map{
        height: 50%;
      }

      .enter{
        color: green;
      }
      .update{
        color: #333;
      }

    </style>
  </head>
  <body>

    <div id="map"></div>
    <div id="weather"></div>

    <script>

      var map = L.map('map');
      L.tileLayer.provider('OpenStreetMap.BlackAndWhite').addTo(map);
      map.setView([59.311162, 18.074806], 13);

      map.on('click', onMapClick);

      var weather = d3.select("#weather");


      function onMapClick(e){
        update(e.latlng.lat, e.latlng.lng);
      }


      function update(lat, lng){
        var data = [];

        var urlOpenweather = "http://api.openweathermap.org/data/2.5/forecast/daily?lat="+ lat + "&lon="+ lng + "&cnt=10&appid=c49e630f0dba743273c6876aea593115";

        var urlDarksky = "https://api.darksky.net/forecast/b0b3a61c7b298b74be766a5d9a40bf70/" + lat + "," + lng + "?"
        + "lang=sv"
        + "&units=si";

        d3.json(urlDarksky,
          function(error, json) {
            if(error) return console.warn(error);

            data.push(json);
            draw(data);

          });
      }


      function draw(dataset){

        var key = function(d){
          return d.city.name;
        }

        var info = weather.selectAll("p")
          .data(dataset, key);

        info
          .attr("class", "update");

        info
          .enter()
          .append("p")
          .attr("class", "enter")
          .text(function(d){
            return d.city.name;
          });

        info.exit().remove();

      }

    </script>

  </body>
</html>
